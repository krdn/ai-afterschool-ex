'use server';

import { revalidatePath } from 'next/cache';
import { verifySession } from '@/lib/dal';
import { getBudgetSummary } from '@ais/ai-engine';
import type { ProviderName, FeatureType } from '@ais/ai-engine';
import { ok, type ActionResult } from "@/lib/errors/action-result";

async function requireDirector() {
  const session = await verifySession();
  if (!session || session.role !== 'DIRECTOR') {
    throw new Error('Unauthorized: DIRECTOR role required');
  }
  return session;
}

export async function getBudgetSummaryAction(): Promise<any> {
  await requireDirector();
  return getBudgetSummary();
}

export async function setDefaultProviderAction(provider: ProviderName): Promise<ActionResult<{ provider: ProviderName }>> {
  await requireDirector();

  const { db } = await import('@ais/db/client');
  // ... 생략 (이후 admin/providers로 대체 예정) 
  return ok({ provider });
}
